# HTTPS redirect middleware
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: redirect-https
  namespace: myintell
spec:
  redirectScheme:
    scheme: https
    permanent: true
---
# www to apex redirect
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: redirect-www
  namespace: myintell
spec:
  redirectRegex:
    regex: "^https?://www\\.myintell\\.ai/(.*)"
    replacement: "https://myintell.ai/${1}"
    permanent: true
---
# Dashboard IngressRoute - HTTP (redirect to HTTPS)
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: dashboard-http
  namespace: myintell
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`myintell.ai`)
      kind: Rule
      middlewares:
        - name: redirect-https
      services:
        - name: dashboard
          port: 3000
    - match: Host(`www.myintell.ai`)
      kind: Rule
      middlewares:
        - name: redirect-www
      services:
        - name: dashboard
          port: 3000
---
# Dashboard IngressRoute - HTTPS
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: dashboard-https
  namespace: myintell
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`myintell.ai`)
      kind: Rule
      services:
        - name: dashboard
          port: 3000
    - match: Host(`www.myintell.ai`)
      kind: Rule
      middlewares:
        - name: redirect-www
      services:
        - name: dashboard
          port: 3000
  tls:
    secretName: myintell-ai-tls
---
# API IngressRoute - HTTP (redirect to HTTPS)
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: api-http
  namespace: myintell
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`api.myintell.ai`)
      kind: Rule
      middlewares:
        - name: redirect-https
      services:
        - name: platform-api
          port: 3001
---
# API IngressRoute - HTTPS
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: api-https
  namespace: myintell
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`api.myintell.ai`)
      kind: Rule
      services:
        - name: platform-api
          port: 3001
  tls:
    secretName: api-myintell-ai-tls
